# Project Pre-Burn: Day 9 - The First Hardware Cipher

> **Date:** 2026-01-06 (Beijing Time)
> **Status:** Hardware Verified (Physical Loop Closed)
> **Author:** Future IC Engineer

## 1. 项目概述 (Overview)

本项目是《预燃行动 (Project Pre-Burn)》的第九天里程碑。
**核心目标**：从零构建并验证一个**实时流加密系统 (Stream Cipher System)**，将 UART 通信、LFSR 伪随机数发生器与异或加密逻辑在物理层面实现全系统集成。
**战略意义**：
1.  **物理闭环**：首次跑通从 RTL 设计 -> XDC 约束 -> Bitstream 烧录 -> 硬件实测的完整工业流程。
2.  **系统思维**：从单一模块设计（ALU）升级为多模块协同（SoC 原型），解决了复位极性冲突与时序对齐问题。

## 2. 开发环境 (Environment)

* **IDE**: Xilinx Vivado 2024.x
* **Device**: Digilent Basys3 (Artix-7 `xc7a35tcpg236-1`)
* **Tool**: SSCOM V5.13.1 (Serial Debugging Assistant)
* **Language**: Verilog HDL (System Integration Level)

## 3. 理论军火库 (Knowledge Base)

在 Day 9 的实战中，我们将以下核心理论转化为物理电路：

### A. 流加密 (Stream Cipher)
* **概念**：利用密钥流（Key Stream）与明文流（Plaintext）进行逐位异或（XOR）。
* **公式**：$Cipher = Plain \oplus Key$
* **特性**：一字一密。每接收一个字节，LFSR 自动跳变产生新密钥，彻底告别“静态密码本”。

### B. 线性反馈移位寄存器 (LFSR)
* **数学模型**：基于本原多项式 $P(x) = x^8 + x^6 + x^5 + x^4 + 1$。
* **硬件意义**：以极低的资源消耗（仅用 8 个寄存器 + 几个异或门）产生周期为 255 的伪随机序列。

### C. 物理约束 (Physical Constraints)
* **概念**：代码中的 `port` 只是逻辑概念，必须通过 `.xdc` 文件映射到芯片的物理引脚（Pin）上。
* **实战教训**：解决了 Basys3 按键 `U18` 是**高电平有效**，而代码通常默认为**低电平复位**的极性冲突。

## 4. 模块定义与硬件映射 (Specs & Pinout)

### 顶层模块: `top.v`

这是整个 SoC 的控制中心，负责调度 UART 收发与加密内核。

| 端口名 | 方向 | 物理引脚 (Basys3) | 硬件组件 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| `sys_clk` | input | **W5** | 100MHz OSC | 系统主时钟 |
| `sys_rst` | input | **U18** | Center Button | **高电平复位** (按下重置密钥) |
| `rx` | input | **B18** | USB-RS232 | 串口接收 (PC -> FPGA) |
| `tx` | output| **A18** | USB-RS232 | 串口发送 (FPGA -> PC) |
| `sw_encrypt`| input | **V17** | Switch (Right) | **上拨**: 开启加密 / **下拨**: 原始回环 |

### 逻辑功能表 (Operation Table)

通过 MUX (多路选择器) 控制数据流向：

| 开关状态 (V17) | 模式 | 数据路径 | 预期行为 |
| :--- | :--- | :--- | :--- |
| **0 (Down)** | Loopback | `tx_data = rx_data` | 发送 'A' -> 收到 'A' (透传) |
| **1 (Up)** | **Encrypt** | `tx_data = rx_data ^ lfsr_key` | 发送 'A' -> 收到 **'BE'** (加密) |

## 5. 验证与审计 (Verification & Audit)

### 物理实测 (Hardware Test) - *Passed*

使用 SSCOM 串口助手进行“黑盒测试”，验证结果具有**数学唯一性**：

* **测试条件**：波特率 115200，LFSR 初始种子 `8'hFF`。
* **输入向量**：`0x41` (字符 'A', 二进制 `0100 0001`)
* **密钥状态**：`0xFF` (初始密钥, 二进制 `1111 1111`)
* **硬件输出**：**`0xBE`** (二进制 `1011 1110`)
* **结论**：`01000001 ^ 11111111 = 10111110`。物理输出与理论计算**像素级吻合**，证明逻辑门电路工作正常。

### 综合与实现 (Implementation)
* **Bitstream**: 生成成功 (`top.bit`)。
* **Timing**: 时序收敛 (No Negative Slack)。
* **IO Planning**: 所有端口电平标准统一为 `LVCMOS33`。

## 6. 核心认知升级 (Key Learnings)

1.  **代码 vs 产品**：
    * Day 6 的代码只是文本文件。
    * Day 9 的 `top.bit` 是可以在硅片上运行的电路。
    * **"Works on Simulation"** 和 **"Works on Board"** 之间隔着巨大的物理鸿沟（时钟抖动、复位极性、引脚电压）。
2.  **复位的哲学**：
    * 在仿真里 `rst_n` 只是个变量。
    * 在板子上，必须查阅原理图确认按钮按下是 `1` 还是 `0`。搞错这一点，系统永远处于复位状态。
3.  **不可见变为可见**：
    * 通过串口助手的 HEX 显示，我们将看不见的电压变化转化为了可读的十六进制数据。

## 7. 顾问评价 (Advisor's Note)

> "你已经跨越了 FPGA 学习最危险的'仿真舒适区'。
> 很多人在仿真波形完美后就止步不前，而你坚持完成了 XDC 约束和硬件调试，并亲眼见证了 `BE` 这个加密数据的诞生。
>
> 现在的 `lab06` 虽然看起来只是个简单的异或逻辑，但它是一个完整的硬件系统内核。
> **下一步 (Day 10)**：我们将给这个内核加上'显示器'（数码管驱动），让它从'黑盒'变成真正的'可交互产品'。"

---

*Generated by Gemini - Your Brutally Honest Advisor*