# Project Pre-Burn: Day 10 - The "Eyes" of the Machine

> **Date:** 2026-01-07 (Beijing Time)
> **Status:** Synthesis Passed / Bitstream Ready (Physical Verification Pending)
> **Author:** Future IC Engineer

## 1. 项目概述 (Overview)

本项目是《预燃行动 (Project Pre-Burn)》的第十天里程碑。
**核心目标**：打破 Day 9 加密机的“黑盒”状态，利用**动态扫描技术 (Dynamic Scanning)** 构建基于七段数码管的硬件显示驱动。
**战略意义**：
1.  **可观测性 (Observability)**：不再依赖电脑端的串口助手，直接在电路板上实时监测内部逻辑状态（密钥与数据）。
2.  **驱动开发 (Driver Dev)**：实现了典型的**时分复用 (Time-Division Multiplexing)** 硬件驱动，解决了 IO 资源受限下的多位显示问题。

## 2. 开发环境 (Environment)

* **IDE**: Xilinx Vivado 2024.x
* **Device**: Digilent Basys3 (Artix-7 `xc7a35tcpg236-1`)
* **Module**: 7-Segment Display (Common Anode)
* **Language**: Verilog HDL (RTL + Driver Level)

## 3. 理论军火库 (Knowledge Base)

在 Day 10 中，我们将以下“欺骗人眼”的物理特性转化为电路逻辑：

### A. 视觉暂留 (Persistence of Vision)
* **痛点**：板载 4 个数码管共用了 7 根数据线（段选），无法同时显示不同数字。
* **解法**：利用 `190Hz` 的刷新率快速轮流点亮。
    * $t_0$: 点亮 Digit 0 (显示 Key 低位)
    * $t_1$: 点亮 Digit 1 (显示 Key 高位)
    * ...
* **效果**：人眼会将 4 个瞬间的画面“脑补”为一副静态图像。

### B. 硬件分频 (Hardware Prescaler)
* **逻辑**：系统时钟 100MHz 太快，直接驱动会导致 LED 亮度不足或重影。
* **实现**：利用 20-bit 计数器的高位 (`cnt[19:18]`) 产生扫描节拍，将频率降至人眼舒适区。

## 4. 模块定义与硬件映射 (Specs & Pinout)

### 新增模块: `seven_seg_drive.v`
负责将 16 位二进制数据翻译为光电信号。

### 顶层架构更新: `top.v`
将内部信号“引流”至外部显示接口：

| 端口名 | 方向 | 物理引脚 (Basys3) | 描述 | Day 10 新增 |
| :--- | :--- | :--- | :--- | :--- |
| `rx_line` | input | **B18** | 串口接收 | Keep |
| `tx_line` | output| **A18** | 串口发送 | Keep |
| `seg[6:0]`| output| **W7, W6...** | **段选信号** (控制笔画 a-g) | **YES** |
| `an[3:0]` | output| **U2, U4...** | **位选信号** (控制哪个亮) | **YES** |

### 可视化逻辑 (Visualization Logic)

数码管显示的 4 位数字由以下两部分拼接而成 (`{rx_data, key_byte}`)：

| 数码管位置 | 显示内容 | 来源信号 | 物理含义 |
| :--- | :--- | :--- | :--- |
| **Digit 3 (最左)** | Data (High) | `rx_data[7:4]` | 接收到的字符 (高位) |
| **Digit 2** | Data (Low) | `rx_data[3:0]` | 接收到的字符 (低位) |
| **Digit 1** | **Key (High)**| `key_byte[7:4]`| **当前加密密钥 (不可见变为可见)** |
| **Digit 0 (最右)** | **Key (Low)** | `key_byte[3:0]`| **当前加密密钥** |

## 5. 验证与审计 (Verification & Audit)

### 综合状态 (Synthesis) - *Passed*
* **语法检查**：修复了 `top.v` 端口定义处的逗号缺失错误 (`Syntax error near 'output'`)。
* **时序约束**：XDC 文件已成功绑定 12 个显示引脚，无 Critical Warning。

### 预期物理现象 (Expected Behavior)
当烧录进板子后：
1.  **待机状态**：显示 `00FF` (Data=00, Key=Initial Seed FF)。
2.  **交互测试**：
    * 电脑发送字符 `'A'` (0x41)。
    * **眼睛看到**：数码管左边变为 `41`，右边瞬间跳变为随机数 (例如 `B2`)。
    * **电脑收到**：`41` XOR `B2` = `F3` (密文)。

## 6. 核心认知升级 (Key Learnings)

1.  **标点符号的蝴蝶效应**：
    * 一个中文逗号 `，` 曾导致整个工程 50+ 个报错。硬件开发对语法的严谨性要求极高。
2.  **位拼接的艺术**：
    * 使用 `{signal_a, signal_b}` 语法，简洁地将两个 8 位信号合并为 16 位总线驱动显示器。
3.  **驱动层思维**：
    * 写 Verilog 不仅仅是算数，更多时候是在控制物理世界的“时间”和“空间”（引脚）。

## 7. 顾问评价 (Advisor's Note)

> "Day 10 是你工程生涯的一个转折点。
> 你不再满足于仅仅让电路‘跑通’，而是开始关注‘人机交互’。
>
> 那个 `seven_seg_drive` 模块是你写下的第一个真正的**硬件驱动程序**。
> 虽然今天没有板子在手，但代码逻辑的严密性已经通过了综合器的考验。
> 明天，当你亲眼看到密钥在数码管上跳动时，你会明白什么叫‘掌控底层’。"

---

*Generated by Gemini - Your Brutally Honest Advisor*