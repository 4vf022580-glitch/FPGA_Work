# Project Pre-Burn: Day 2 - The Assembly Line

> **Date:** 2025-12-29 (Beijing Time)![alt text]
> **Status:** Mission Accomplished (100% Complete)
> **Author:** Future IC Engineer

## 1. 项目概述 (Overview)

本项目是《预燃行动 (Project Pre-Burn)》的第二天成果。
**核心目标**：突破“单体设计”限制，利用 **模块化 (Hierarchy)** 思想构建一个 4 级级联 ALU 运算链 (`alu_chain`)。
**战略意义**：掌握 FPGA 设计中的核心能力——**系统集成 (System Integration)**。学会像搭积木一样实例化模块，并管理模块间的内部连线。

## 2. 开发环境 (Environment)

* **IDE**: Xilinx Vivado 2024.x
* **Device**: Artix-7 `xc7a35tcpg236-1`
* **Scope**: RTL Design & Behavioral Simulation
* **Language**: Verilog HDL

## 3. 理论军火库 (HDLBits Knowledge Base)

在 HDLBits 的 *Modules: Hierarchy* 章节中，我们提炼了以下关键概念，并在此次工程中完成了物理落地：

### A. 实例化 (Instantiation) —— “克隆机器”

* **概念**：`module` 只是图纸，实例化才是造出机器。
* **语法**：`mod_name instance_name (.port_name(signal_name));`
* **口诀**：“点是端口（永远不变），括号是线（随你怎么接）”。
* **实战应用**：在 `alu_chain` 中调用了 4 次 `alu`，分别命名为 `u_alu_1` 到 `u_alu_4`。

### B. 内部连线 (Internal Wires) —— “隐形传送带”

* **概念**：模块与模块之间不能通过空气传播信号，必须有物理导线。
* **语法**：`wire [3:0] link_1;`
* **实战应用**：定义 `link_1`, `link_2`, `link_3` 将前一级的 `.out` 连接到下一级的 `.a`，形成数据通路。

### C. 锁存器危害 (Latches) —— “隐形杀手”

* **概念**：在组合逻辑 (`always @*`) 中，如果 `case` 或 `if` 没有覆盖所有情况，工具会生成锁存器 (Latch) 来保持数值。
* **后果**：导致时序极度不稳定，是 FPGA 设计的大忌。
* **防御手段**：在 `alu.v` 的 `case` 语句中强制添加 `default: out = 4'b0000;`。

## 4. 模块定义 (Design Specifications)

### 子模块: `alu.v` (标准零件)

这是流水线上的标准工位。为了配合级联，规范化为 4 位宽。

| 端口名 | 方向 | 位宽 | 功能 |
| --- | --- | --- | --- |
| `a`, `b` | input | [3:0] | 操作数 |
| `op` | input | [1:0] | `00`: Add, `01`: Sub, `10`: AND, `11`: OR |
| `out` | output | [3:0] | 运算结果 |

### 顶层模块: `alu_chain.v` (总装车间)

负责将 4 个 ALU 串联，形成 **Head -> ALU1 -> ALU2 -> ALU3 -> ALU4 -> Final** 的结构。

| 端口名 | 方向 | 描述 |
| --- | --- | --- |
| `head_data` | input | 链头的初始数据 (原料) |
| `d1` ~ `d4` | input | 每一级 ALU 的副操作数 (辅料) |
| `op` | input | 全局广播指令，所有 ALU 共用 |
| `final_result` | output | 第 4 级运算后的最终产物 |

## 5. 验证与仿真 (Verification)

### 静态验证 (Elaborated Design)

* **Set as Top**: 解决了 `alu.v` 霸占顶层导致无法综合 `chain` 的问题。
* **Schematic Check**: 成功生成了“蜈蚣图”。
* 验证了 4 个 ALU 实例 (`u_alu_1`~`4`) 存在且连接正确。
* 验证了 `link` 信号线没有断路或短路。



### 动态仿真 (Behavioral Simulation)

* **Testbench**: `tb_alu_chain.v`
* **核心机制**:
* `reg` 用于输入（信号发生器），`wire` 用于输出（示波器）。
* `initial` 块配合 `#100` 延时，构建时间轴上的测试剧本。


* **测试场景与结果**:

| 时间段 (ns) | 测试场景 | 输入数据 | 预期公式 | 实测结果 | 结论 |
| --- | --- | --- | --- | --- | --- |
| **0 - 100** | **级联加法** | `head=0`, `d=1` |  | **4** | **Pass** |
| **100 - 200** | **级联逻辑** | `head=F`, `d=5` |  | **5** (`0101`) | **Pass** |

## 6. 核心认知升级 (Key Learnings)

1. **分层验证体系 (The Verification Pyramid)**:
* **Level 1**: Syntax Check (综合不报错只是第一步)。
* **Level 2**: Schematic (看图纸确认连线逻辑)。
* **Level 3**: Simulation (看波形确认功能正确)。*这是最高真理。*


2. **Top Module 的皇权**: Vivado 只会综合被设为 `Top` 的文件。如果层级混乱，必须手动 `Set as Top`。
3. **Testbench 思维**: 验证不是把代码再看一遍，而是建立一个“封闭实验室”，自己模拟外界信号（激励）去轰炸芯片，看它是否扛得住。
4. **工程纪律**: 命名规范 (`link_1` vs `link1`) 和位宽匹配 (`4'b0` vs `2'b0`) 是避免低级错误的护城河。

## 7. 顾问评价 (Advisor's Note)

> "Day 2 的战斗含金量极高。你不仅写出了代码，更重要的是你亲自撞上了 'Spawn failed' 和 'Set as Top' 这些新手墙，并亲手拆除了它们。你发来的那张 Schematic '蜈蚣图' 和 Simulation '绿波形'，是你能进入 Day 3（时序逻辑）的入场券。现在的你，已经从'画点'进化到了'画线'。明天，我们将引入最重要的维度——时间 (Clock)。"

---

*Generated by Gemini - Your Brutally Honest Advisor*