`timescale 1ns / 1ps

//================================================================================
// Module Name:    tb_alu_chain
// Description:    ALU 级联模块仿真平台
//                 验证多级组合逻辑的累积运算结果。
//
// Focus:          1. 验证级联数据通路 (Cascaded Data Path) 的正确性。
//                 2. 观察长组合逻辑路径的信号传播延迟 (Propagation Delay)。
//================================================================================

module tb_alu_chain(); // Testbench 无端口

    //----------------------------------------------------------------------------
    // 1. 信号定义 (Signal Definitions)
    //----------------------------------------------------------------------------
    // 激励信号 (Stimulus)
    reg [3:0] head_data;          // 链头输入
    reg [3:0] d1, d2, d3, d4;     // 各级级联操作数
    reg [1:0] op;                 // 全局操作码

    // 观测信号 (Observation)
    wire [3:0] final_result;      // 最终链尾输出

    //----------------------------------------------------------------------------
    // 2. 待测设备实例化 (DUT Instantiation)
    //----------------------------------------------------------------------------
    alu_chain uut (
        .head_data    (head_data),
        .d1(d1), .d2(d2), .d3(d3), .d4(d4),
        .op           (op),
        .final_result (final_result)
    );

    //----------------------------------------------------------------------------
    // 3. 自动监测 (System Monitor)
    //----------------------------------------------------------------------------
    initial begin
        // 打印表头
        $display("Time | OP | Head | D1 | D2 | D3 | D4 | Result");
        $display("-----+----+------+----+----+----+----+-------");
        // 当任何信号变化时，打印当前状态
        $monitor("%4t | %b |  %d   | %d  | %d  | %d  | %d  |   %d", 
                 $time, op, head_data, d1, d2, d3, d4, final_result);
    end

    //----------------------------------------------------------------------------
    // 4. 主测试激励 (Main Stimulus)
    //----------------------------------------------------------------------------
    initial begin
        //========================================================================
        // Scene A: 累加链测试 (Accumulation Chain)
        //========================================================================
        // Logic: ((0 + 1) + 1) + 1) + 1 = 4
        // 这是一个纯组合逻辑链，信号会像多米诺骨牌一样瞬间(仿真中)穿过所有 ALU。
        head_data = 0;
        d1 = 1; d2 = 1; d3 = 1; d4 = 1; 
        op = 2'b00; // ADD
        
        // 建立时间 (Settling Time): 
        // 现实中信号穿过4层 ALU 需要时间 (例如 4 * 5ns = 20ns)。
        // 这里的 #100 提供了充足的裕量。
        
        #100; 

        //========================================================================
        // Scene B: 掩码链测试 (Masking Chain)
        //========================================================================
        // Logic: 1111 & 0101 & 1111 & 1111 & 1111 = 0101
        // 验证数据能否正确穿过每一层逻辑门而不丢失。
        head_data = 4'b1111; // 初始全 1
        d1 = 4'b0101;        // 第1级进行掩码 (Masking)
        d2 = 4'b1111;        // 后续全 1 (保持不变)
        d3 = 4'b1111;
        d4 = 4'b1111;
        op = 2'b10;          // AND
        
        #100;
        
        //========================================================================
        // Scene C: 混合测试 (Verification End)
        //========================================================================
        $display("Simulation Finished.");
        $stop; 
    end

endmodule