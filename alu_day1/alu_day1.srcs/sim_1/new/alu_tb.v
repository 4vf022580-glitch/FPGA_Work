`timescale 1ns / 1ps

//================================================================================
// Module Name:    alu_tb
// Description:    ALU 模块仿真验证平台 (Testbench)
//                 验证 4-bit 输入在不同操作码下的 8-bit 输出行为。
//
// Verification Strategy:
//    1. 基础算术验证 (Basic Arithmetic): 加法与减法。
//    2. 位操作验证 (Bit Manipulation): 符号扩展与位翻转。
//    3. 自检输出 (Self-Checking): 使用 $monitor 实时打印结果。
//================================================================================

module alu_tb(); // Testbench 是封闭环境，无外部端口

    //----------------------------------------------------------------------------
    // 1. 信号定义 (Signal Definitions)
    //----------------------------------------------------------------------------
    // 激励信号 (Stimulus): 对应 ALU 的 input，必须是 reg 类型
    reg [3:0] a;
    reg [3:0] b;
    reg [1:0] op;

    // 观测信号 (Observation): 对应 ALU 的 output，必须是 wire 类型
    wire [7:0] res;

    //----------------------------------------------------------------------------
    // 2. 待测设备实例化 (DUT Instantiation)
    //----------------------------------------------------------------------------
    alu uut (
        .a   (a), 
        .b   (b), 
        .op  (op), 
        .res (res)
    );

    //----------------------------------------------------------------------------
    // 3. 自动监测 (System Monitor) - [新增的高级功能]
    //----------------------------------------------------------------------------
    initial begin
        // 打印表头，方便阅读
        $display("----------------------------------------------------------------");
        $display("Time | OP |   A  |   B  |  Result (Hex) |  Result (Dec/Bin)   ");
        $display("-----+----+------+------+---------------+---------------------");
        
        // $monitor: 只要信号列表里的任何一个值发生变化，就会自动打印一行
        $monitor("%4t | %b | %d | %d |      %h       |      %d / %b", 
                 $time, op, a, b, res, res, res);
    end

    //----------------------------------------------------------------------------
    // 4. 主测试激励 (Main Stimulus)
    //----------------------------------------------------------------------------
    initial begin
        //========================================================================
        // Case 1: 加法测试 (Addition)
        //========================================================================
        // Exp: 3 + 2 = 5 -> res should be 00000101
        a = 3; b = 2; op = 2'b00;
        #10; // 等待电路稳定
        
        //========================================================================
        // Case 2: 减法测试 (Subtraction)
        //========================================================================
        // Exp: 3 - 2 = 1 -> res should be 00000001
        a = 3; b = 2; op = 2'b01;
        #10;
        
        //========================================================================
        // Case 3: 符号扩展 (Sign Extension)
        //========================================================================
        // Input: 4'b1111 (-1 in 4-bit)
        // Exp: Sign extend to 8-bit -> 8'b11111111 (-1 in 8-bit / 255 unsigned)
        a = 4'b1111; b = 0; op = 2'b10;
        #10;
        
        //========================================================================
        // Case 4: 位反转 (Bit Reversal)
        //========================================================================
        // Input: 4'b1010 (Decimal 10)
        // Logic: Reverse -> 0101, Pad High 4-bits with 0
        // Exp: 8'b0000_0101 (Decimal 5)
        a = 4'b1010; b = 0; op = 2'b11;
        #10;
        
        //========================================================================
        // Simulation End
        //========================================================================
        $display("----------------------------------------------------------------");
        $finish; // 停止仿真
    end

endmodule